<!DOCTYPE html>
<html>
  <head>
    <title>Orders - AgriMart</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <%- include("partials/header", { user: user }) %> <% if(orders.length ===
    0){ %>
    <div class="no-product">No Orders Available</div>
    <% } else { %>

    <div class="orders-container">
      <% orders.forEach(buyer => { %>
      <div class="order-card">
        <!-- Buyer Info -->
        <div class="buyer-info">
          <h2 class="buyer-name"><%= buyer.buyerName %></h2>
          <p class="buyer-contact">
            ğŸ“ <%= buyer.buyerPhone %> | âœ‰ï¸ <%= buyer.buyerEmail %>
          </p>
        </div>

        <!-- Address -->
        <div class="buyer-address">
          <div><strong>Street:</strong> <%= buyer.buyerAddress.street %></div>
          <div><strong>City:</strong> <%= buyer.buyerAddress.city %></div>
          <div><strong>State:</strong> <%= buyer.buyerAddress.state %></div>
          <div><strong>Zip:</strong> <%= buyer.buyerAddress.zip %></div>
        </div>

        <!-- Products -->
        <div class="products-box">
          <h4>ğŸ›’ Products Ordered</h4>
          <% buyer.orders.forEach(product => { %>
          <div class="product-item">
            <!-- Left: Product info -->
            <div class="product-info">
              <%= product.productName %> - â‚¹<%= product.price %> Ã— <%=
              product.quantity %>
            </div>

            <!-- Right: Button + Status together -->
            <div class="action-group">
              <% if(product.status === "pending"){ %>
              <button
                class="update-btn"
                onclick="updateOrder('<%= product.orderId %>')"
              >
                Mark as Shipped
              </button>
              <% } %>
              <span class="status-badge <%= product.status %>">
                <%= product.status %>
              </span>
            </div>
          </div>
          <% }) %>
        </div>

        <p class="total">ğŸ’° Total Amount: â‚¹<%= buyer.totalSales %></p>
      </div>
      <% }) %>
    </div>
    <% } %>

    <script>
      function updateOrder(orderId) {
        fetch(`/order/update-order-shipped/${orderId}`, {
          method: "POST",
        })
          .then((res) => res.json())
          .then((data) => location.reload())
          .catch((err) => console.error(err));
      }
    </script>
  </body>
</html>
